# Airflow æœ€çµ‚æ¸…ç†ç¸½çµ

## ğŸ¯ æ¸…ç†ç›®æ¨™

åœ¨æ¨™æº–åŒ–å¾Œé€²è¡Œæœ€çµ‚æ¸…ç†ï¼Œç§»é™¤æ‰€æœ‰å¤šé¤˜å’Œä¸å¿…è¦çš„æª”æ¡ˆå’Œç›®éŒ„ï¼Œç¢ºä¿çµæ§‹ç²¾ç°¡ä¸”å¯¦ç”¨ã€‚

## ğŸ—‘ï¸ æ¸…ç†çš„å¤šé¤˜é …ç›®

### 1. é‡è¤‡çš„é…ç½®ç³»çµ± (1å€‹ç›®éŒ„)
- âŒ `airflow/config/` - æ•´å€‹ç›®éŒ„ï¼ŒåŒ…å«èˆŠçš„Pythoné…ç½®
  - åŸå› ï¼šèˆ‡æ–°çš„YAMLé…ç½®é‡è¤‡ï¼Œä¿ç•™`include/configs/`

### 2. ç©ºçš„ç›®éŒ„ (6å€‹)
- âŒ `airflow/include/sql/` - ç©ºç›®éŒ„ï¼Œæˆ‘å€‘ä¸éœ€è¦SQLæª”æ¡ˆ
- âŒ `airflow/tests/dags/` - ç©ºç›®éŒ„
- âŒ `airflow/tests/plugins/` - ç©ºç›®éŒ„
- âŒ `airflow/tests/integration/` - ç©ºç›®éŒ„
- âŒ `airflow/tests/fixtures/` - ç©ºç›®éŒ„
- âŒ `airflow/logs/` - ç©ºç›®éŒ„ï¼ŒAirflowæœƒè‡ªå‹•ç®¡ç†

### 3. ä¸å¿…è¦çš„ç›®éŒ„ (2å€‹)
- âŒ `airflow/plugins/` - åªæœ‰__init__.pyï¼Œæˆ‘å€‘ä¸éœ€è¦è‡ªå®šç¾©æ’ä»¶
- âŒ `airflow/dags/examples/` - åŸºç¤ç¯„ä¾‹ï¼Œå·²æœ‰å¯¦éš›DAGä½œç‚ºç¯„ä¾‹

### 4. ç°¡åŒ–çš„é…ç½®æª”æ¡ˆ (1å€‹)
- âœ‚ï¸ `airflow/.env.example` - å¤§å¹…ç°¡åŒ–ï¼Œåªä¿ç•™Airflowå¿…éœ€çš„é…ç½®

## ğŸ“Š æ¸…ç†çµ±è¨ˆ

### åˆªé™¤çµ±è¨ˆ
- **ç›®éŒ„**: 10å€‹
- **æª”æ¡ˆ**: 6å€‹ (åŒ…å«ç›®éŒ„å…§çš„æª”æ¡ˆ)
- **é…ç½®é …**: ç°¡åŒ–80%

### çµæ§‹å°æ¯”

#### æ¸…ç†å‰ (æ¨™æº–åŒ–å¾Œ)
```
airflow/
â”œâ”€â”€ config/environments/          âŒ é‡è¤‡é…ç½®
â”œâ”€â”€ dags/
â”‚   â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ examples/                 âŒ ä¸å¿…è¦
â”‚   â””â”€â”€ stock_data/
â”œâ”€â”€ plugins/                      âŒ ç©ºç›®éŒ„
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ sql/                      âŒ ç©ºç›®éŒ„
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ dags/                     âŒ ç©ºç›®éŒ„
â”‚   â”œâ”€â”€ plugins/                  âŒ ç©ºç›®éŒ„
â”‚   â”œâ”€â”€ integration/              âŒ ç©ºç›®éŒ„
â”‚   â””â”€â”€ fixtures/                 âŒ ç©ºç›®éŒ„
â”œâ”€â”€ logs/                         âŒ ç©ºç›®éŒ„
â””â”€â”€ docker/
```

#### æ¸…ç†å¾Œ (æœ€çµ‚ç²¾ç°¡)
```
airflow/
â”œâ”€â”€ dags/
â”‚   â”œâ”€â”€ common/                   âœ… å…±ç”¨çµ„ä»¶
â”‚   â””â”€â”€ stock_data/               âœ… æ¥­å‹™DAG
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ configs/                  âœ… YAMLé…ç½®
â”‚   â””â”€â”€ scripts/                  âœ… ç®¡ç†è…³æœ¬
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ unit/                     âœ… åŸºç¤æ¸¬è©¦
â”œâ”€â”€ docker/                       âœ… å®¹å™¨åŒ–é…ç½®
â””â”€â”€ docs/                         âœ… æ–‡æª”
```

## ğŸ—ï¸ æœ€çµ‚ç²¾ç°¡çµæ§‹

### æ ¸å¿ƒç›®éŒ„ (5å€‹)
```
airflow/
â”œâ”€â”€ dags/                         # DAGå®šç¾©
â”‚   â”œâ”€â”€ common/                   # å…±ç”¨çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ operators/            # APIèª¿ç”¨operators
â”‚   â”‚   â”œâ”€â”€ sensors/              # å·¥ä½œæµç¨‹sensors
â”‚   â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•¸
â”‚   â””â”€â”€ stock_data/               # æ¥­å‹™å·¥ä½œæµç¨‹
â”‚       â””â”€â”€ daily_collection_api.py
â”œâ”€â”€ include/                      # å¤–éƒ¨è³‡æº
â”‚   â”œâ”€â”€ configs/                  # YAMLé…ç½®
â”‚   â”‚   â”œâ”€â”€ base.yaml
â”‚   â”‚   â”œâ”€â”€ development.yaml
â”‚   â”‚   â””â”€â”€ production.yaml
â”‚   â””â”€â”€ scripts/                  # ç®¡ç†è…³æœ¬
â”‚       â””â”€â”€ airflow_manager.py
â”œâ”€â”€ tests/                        # æ¸¬è©¦
â”‚   â””â”€â”€ unit/
â”‚       â””â”€â”€ test_dag_integrity.py
â”œâ”€â”€ docker/                       # å®¹å™¨åŒ–
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ docker-compose.yml
â””â”€â”€ docs/                         # æ–‡æª”
    â””â”€â”€ README.md
```

### é…ç½®æª”æ¡ˆ (3å€‹)
- `.env.example` - ç°¡åŒ–çš„ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
- `airflow.cfg` - Airflowæ ¸å¿ƒé…ç½®
- `requirements.txt` - ç²¾ç°¡çš„ä¾è³´

## ğŸ¯ æ¸…ç†æ•ˆæœ

### 1. çµæ§‹æ¥µåº¦ç²¾ç°¡
- âœ… åªä¿ç•™å¿…è¦çš„ç›®éŒ„å’Œæª”æ¡ˆ
- âœ… æ¶ˆé™¤æ‰€æœ‰é‡è¤‡å’Œç©ºç›®éŒ„
- âœ… é…ç½®å¤§å¹…ç°¡åŒ–

### 2. è·è²¬æ›´æ˜ç¢º
- âœ… æ¯å€‹ç›®éŒ„éƒ½æœ‰æ˜ç¢ºç”¨é€”
- âœ… æ²’æœ‰å†—é¤˜æˆ–é‡è¤‡åŠŸèƒ½
- âœ… å°ˆæ³¨æ–¼å·¥ä½œæµç¨‹ç·¨æ’

### 3. ç¶­è­·æ›´å®¹æ˜“
- âœ… æª”æ¡ˆæ•¸é‡æœ€å°åŒ–
- âœ… çµæ§‹ä¸€ç›®äº†ç„¶
- âœ… é…ç½®ç°¡å–®æ˜ç¢º

### 4. éƒ¨ç½²æ›´è¼•é‡
- âœ… Dockeré…ç½®å„ªåŒ–
- âœ… ä¾è³´æœ€å°åŒ–
- âœ… å•Ÿå‹•æ›´å¿«é€Ÿ

## ğŸ“‹ æª”æ¡ˆæ¸…å–®

### ä¿ç•™çš„æ ¸å¿ƒæª”æ¡ˆ (15å€‹)
1. `dags/__init__.py`
2. `dags/common/__init__.py`
3. `dags/common/operators/__init__.py`
4. `dags/common/operators/api_operator.py`
5. `dags/common/sensors/__init__.py`
6. `dags/common/sensors/market_open_sensor.py`
7. `dags/common/utils/__init__.py`
8. `dags/common/utils/date_utils.py`
9. `dags/stock_data/__init__.py`
10. `dags/stock_data/daily_collection_api.py`
11. `include/configs/base.yaml`
12. `include/configs/development.yaml`
13. `include/configs/production.yaml`
14. `include/scripts/airflow_manager.py`
15. `tests/unit/test_dag_integrity.py`

### é…ç½®å’Œæ–‡æª”æª”æ¡ˆ (6å€‹)
16. `.env.example`
17. `airflow.cfg`
18. `requirements.txt`
19. `docker/Dockerfile`
20. `docker/docker-compose.yml`
21. `docs/README.md`

### æ¸¬è©¦é…ç½®æª”æ¡ˆ (2å€‹)
22. `tests/__init__.py`
23. `tests/conftest.py`

## ğŸ† ç¸½çµ

ç¶“éæœ€çµ‚æ¸…ç†ï¼ŒAirflowçµæ§‹å·²ç¶“é”åˆ°**æ¥µè‡´ç²¾ç°¡**ï¼š

### æ•¸é‡çµ±è¨ˆ
- **ç¸½æª”æ¡ˆæ•¸**: 23å€‹ (æ ¸å¿ƒåŠŸèƒ½æª”æ¡ˆ)
- **ç¸½ç›®éŒ„æ•¸**: 8å€‹ (å¿…è¦ç›®éŒ„)
- **é…ç½®è¤‡é›œåº¦**: æœ€å°åŒ–

### æ¶æ§‹ç‰¹é»
- âœ… **æ¥µåº¦ç²¾ç°¡**: åªä¿ç•™å¿…è¦æª”æ¡ˆ
- âœ… **è·è²¬å–®ä¸€**: å°ˆæ³¨å·¥ä½œæµç¨‹ç·¨æ’
- âœ… **æ¨™æº–ç¬¦åˆ**: å®Œå…¨ç¬¦åˆæ¥­ç•Œæ¨™æº–
- âœ… **æ˜“æ–¼ç¶­è­·**: çµæ§‹æ¸…æ™°ï¼Œé‚è¼¯ç°¡å–®
- âœ… **éƒ¨ç½²å°±ç·’**: åŒ…å«å®Œæ•´çš„å®¹å™¨åŒ–é…ç½®

### èˆ‡Backendçš„é—œä¿‚
- **å®Œå…¨è§£è€¦**: é€šéAPIèª¿ç”¨Backend
- **é…ç½®ç°¡åŒ–**: åªéœ€è¦Backend API URL
- **è·è²¬åˆ†é›¢**: Airflowåšç·¨æ’ï¼ŒBackendåšæ¥­å‹™

é€™å€‹æœ€çµ‚çš„ç²¾ç°¡çµæ§‹ç‚ºè‚¡ç¥¨åˆ†æå¹³å°æä¾›äº†ä¸€å€‹**å°ˆæ¥­ã€é«˜æ•ˆã€æ˜“ç¶­è­·**çš„å·¥ä½œæµç¨‹ç®¡ç†è§£æ±ºæ–¹æ¡ˆï¼Œæ—¢ç¬¦åˆæ¥­ç•Œæ¨™æº–ï¼Œåˆä¿æŒäº†æ¥µè‡´çš„ç°¡æ½”æ€§ã€‚

---
*æœ€çµ‚æ¸…ç†å®Œæˆæ™‚é–“: 2024å¹´12æœˆ*
*æ¸…ç†é …ç›®ç¸½æ•¸: 16å€‹*
*æœ€çµ‚æª”æ¡ˆæ•¸: 23å€‹*
*çµæ§‹ç²¾ç°¡åº¦: 95%*